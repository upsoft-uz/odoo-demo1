<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Book Form View -->
    <record id="view_library_book_form" model="ir.ui.view">
        <field name="name">library.book.form</field>
        <field name="model">library.book</field>
        <field name="arch" type="xml">
            <form string="Book">
                <sheet>
                    <field name="cover_image" widget="image" class="oe_avatar"/>
                    <div class="oe_title">
                        <label for="name"/>
                        <h1>
                            <field name="name" placeholder="Book title..."/>
                        </h1>
                    </div>
                    <group>
                        <group>
                            <field name="author"/>
                            <field name="category_id"/>
                            <field name="isbn"/>
                        </group>
                        <group>
                            <field name="publisher"/>
                            <field name="publication_date"/>
                            <field name="pages"/>
                            <field name="language"/>
                            <field name="active"/>
                        </group>
                    </group>
                    <notebook>
                        <page string="Description">
                            <field name="description" widget="html"/>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>

    <!-- Book Kanban View with Drag & Drop -->
    <record id="view_library_book_kanban" model="ir.ui.view">
        <field name="name">library.book.kanban</field>
        <field name="model">library.book</field>
        <field name="arch" type="xml">
            <kanban default_group_by="category_id" quick_create="false" records_draggable="true">
                <field name="id"/>
                <field name="name"/>
                <field name="author"/>
                <field name="category_id"/>
                <field name="cover_image"/>
                <field name="isbn"/>
                <field name="publisher"/>
                <field name="publication_date"/>
                <field name="pages"/>
                <field name="language"/>
                <field name="description"/>
                <templates>
                    <t t-name="card">
                        <div class="oe_kanban_card library_book_card" style="margin: 8px; width: 200px; border-radius: 4px; overflow: hidden; position: relative;">
                            <!-- Hover Popup with Full Details -->
                            <div class="book_hover_popup" style="display: none; position: absolute; left: 110%; top: 0; width: 280px; background: white; border-radius: 8px; box-shadow: 0 8px 24px rgba(0,0,0,0.2); z-index: 1000; padding: 16px; border: 1px solid #e0e0e0;">
                                <div class="mb-3 pb-3 border-bottom">
                                    <h5 class="mb-2 fw-bold" style="font-size: 14px; line-height: 1.3; color: #2c3e50;">
                                        <field name="name"/>
                                    </h5>
                                    <div class="text-muted" style="font-size: 12px;">
                                        <i class="fa fa-user text-primary me-1"/>
                                        <field name="author"/>
                                    </div>
                                </div>

                                <!-- Publisher -->
                                <div t-if="record.publisher.raw_value" class="mb-2 d-flex align-items-start" style="font-size: 12px;">
                                    <i class="fa fa-building text-info me-2 mt-1" style="width: 16px; flex-shrink: 0;"/>
                                    <div>
                                        <strong class="d-block text-muted" style="font-size: 10px;">Publisher</strong>
                                        <span class="text-dark"><field name="publisher"/></span>
                                    </div>
                                </div>

                                <!-- ISBN -->
                                <div t-if="record.isbn.raw_value" class="mb-2 d-flex align-items-start" style="font-size: 12px;">
                                    <i class="fa fa-barcode text-warning me-2 mt-1" style="width: 16px; flex-shrink: 0;"/>
                                    <div>
                                        <strong class="d-block text-muted" style="font-size: 10px;">ISBN</strong>
                                        <span class="text-dark"><field name="isbn"/></span>
                                    </div>
                                </div>

                                <!-- Publication Date -->
                                <div t-if="record.publication_date.raw_value" class="mb-2 d-flex align-items-start" style="font-size: 12px;">
                                    <i class="fa fa-calendar text-danger me-2 mt-1" style="width: 16px; flex-shrink: 0;"/>
                                    <div>
                                        <strong class="d-block text-muted" style="font-size: 10px;">Published</strong>
                                        <span class="text-dark"><field name="publication_date"/></span>
                                    </div>
                                </div>

                                <!-- Pages -->
                                <div t-if="record.pages.raw_value" class="mb-2 d-flex align-items-start" style="font-size: 12px;">
                                    <i class="fa fa-file-text text-success me-2 mt-1" style="width: 16px; flex-shrink: 0;"/>
                                    <div>
                                        <strong class="d-block text-muted" style="font-size: 10px;">Pages</strong>
                                        <span class="text-dark"><field name="pages"/> pages</span>
                                    </div>
                                </div>

                                <!-- Language -->
                                <div t-if="record.language.raw_value" class="mb-2 d-flex align-items-start" style="font-size: 12px;">
                                    <i class="fa fa-globe text-info me-2 mt-1" style="width: 16px; flex-shrink: 0;"/>
                                    <div>
                                        <strong class="d-block text-muted" style="font-size: 10px;">Language</strong>
                                        <span class="text-dark"><field name="language"/></span>
                                    </div>
                                </div>

                                <!-- Category -->
                                <div class="mt-3 pt-2 border-top">
                                    <span class="badge bg-primary" style="font-size: 11px;">
                                        <field name="category_id"/>
                                    </span>
                                </div>
                            </div>

                            <!-- Card Header with Actions -->
                            <div class="d-flex justify-content-end align-items-start p-2" style="position: absolute; top: 0; right: 0; z-index: 10;">
                                <div class="dropdown">
                                    <button class="btn btn-sm btn-light dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" style="padding: 4px 8px; border: 1px solid #e0e0e0; background: white; border-radius: 4px;">
                                        <i class="fa fa-ellipsis-v"/>
                                    </button>
                                    <ul class="dropdown-menu dropdown-menu-end">
                                        <li>
                                            <a class="dropdown-item" href="#" role="menuitem" type="open">
                                                <i class="fa fa-external-link me-2"/>View
                                            </a>
                                        </li>
                                        <li>
                                            <a class="dropdown-item text-danger" href="#" role="menuitem" type="delete">
                                                <i class="fa fa-trash me-2"/>Delete
                                            </a>
                                        </li>
                                    </ul>
                                </div>
                            </div>

                            <!-- Clickable Card Body -->
                            <div class="oe_kanban_global_click" style="cursor: pointer;">
                                <!-- Book Cover -->
                                <div class="text-center p-3">
                                    <div style="height: 140px; display: flex; align-items: center; justify-content: center;">
                                        <img t-if="record.cover_image.raw_value"
                                             t-att-src="'/web/image/library.book/' + record.id.raw_value + '/cover_image'"
                                             alt="Book Cover"
                                             class="rounded"
                                             style="max-height: 140px; max-width: 100%; object-fit: contain;"/>
                                        <div t-else="" class="d-flex align-items-center justify-content-center bg-light rounded border" style="height: 140px; width: 100px;">
                                            <i class="fa fa-book fa-3x text-secondary" style="opacity: 0.3;"/>
                                        </div>
                                    </div>
                                </div>

                                <!-- Book Info -->
                                <div class="px-3 pb-3">
                                    <!-- Title -->
                                    <h6 class="mb-2 fw-bold text-dark" style="font-size: 13px; line-height: 1.3; height: 38px; overflow: hidden; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical;">
                                        <field name="name"/>
                                    </h6>

                                    <!-- Author -->
                                    <div class="mb-2 text-muted d-flex align-items-center" style="font-size: 11px;">
                                        <i class="fa fa-user text-primary me-1" style="font-size: 10px;"/>
                                        <span class="text-truncate">
                                            <field name="author"/>
                                        </span>
                                    </div>

                                    <!-- Description Preview -->
                                    <div class="mb-2 text-muted" style="font-size: 10px; line-height: 1.4; height: 28px; overflow: hidden; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical;">
                                        <field name="description" widget="html"/>
                                    </div>

                                    <!-- Meta Info -->
                                    <div class="pt-2 border-top" style="margin-top: 8px;">
                                        <div class="d-flex justify-content-between align-items-center mb-1">
                                            <div t-if="record.publication_date.raw_value" class="text-muted" style="font-size: 10px;">
                                                <i class="fa fa-calendar text-danger me-1"/>
                                                <field name="publication_date"/>
                                            </div>
                                            <div t-if="record.language.raw_value" class="text-muted" style="font-size: 10px;">
                                                <i class="fa fa-globe text-info me-1"/>
                                                <field name="language"/>
                                            </div>
                                        </div>
                                        <div t-if="record.pages.raw_value" class="text-muted" style="font-size: 10px;">
                                            <i class="fa fa-file-text text-success me-1"/>
                                            <field name="pages"/> pages
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

    <!-- Book List View -->
    <record id="view_library_book_list" model="ir.ui.view">
        <field name="name">library.book.list</field>
        <field name="model">library.book</field>
        <field name="arch" type="xml">
            <list string="Books">
                <field name="name"/>
                <field name="author"/>
                <field name="category_id"/>
                <field name="isbn"/>
                <field name="publisher"/>
                <field name="publication_date"/>
                <field name="language"/>
            </list>
        </field>
    </record>

    <!-- Book Action -->
    <record id="action_library_book" model="ir.actions.act_window">
        <field name="name">Books</field>
        <field name="res_model">library.book</field>
        <field name="view_mode">kanban,list,form</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Add your first book!
            </p>
            <p>
                Create and organize your library book catalog by categories.
                Drag and drop books between categories in the Kanban view.
            </p>
        </field>
    </record>
</odoo>
